---
layout: default
---

<style>
/* Estilos para Ação Coletiva */
.acao-coletiva {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 40px;
  border-radius: 15px;
  margin: 30px 0;
  box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
}

.acao-coletiva h2 {
  color: white;
  margin-bottom: 10px;
  font-size: 28px;
}

.acao-coletiva p {
  opacity: 0.9;
  margin-bottom: 30px;
}

.canal-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
}

.canal-card {
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(10px);
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 12px;
  padding: 25px;
  transition: all 0.3s;
  cursor: pointer;
}

.canal-card:hover {
  transform: translateY(-5px);
  background: rgba(255, 255, 255, 0.25);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
}

.canal-icon {
  font-size: 48px;
  margin-bottom: 15px;
}

.canal-titulo {
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 10px;
}

.canal-descricao {
  opacity: 0.9;
  font-size: 14px;
  margin-bottom: 15px;
}

.canal-contador {
  background: rgba(255, 255, 255, 0.3);
  padding: 8px 15px;
  border-radius: 20px;
  font-size: 13px;
  display: inline-block;
}

/* Modal Campanha */
.modal-campanha .modal-content {
  border-radius: 15px;
  border: none;
}

.modal-campanha .modal-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 15px 15px 0 0;
  border: none;
}

.preview-mensagem {
  background: #f8f9fa;
  border: 2px dashed #dee2e6;
  border-radius: 10px;
  padding: 20px;
  margin: 20px 0;
  font-family: monospace;
  white-space: pre-wrap;
  max-height: 300px;
  overflow-y: auto;
}

.btn-copiar {
  background: #28a745;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s;
}

.btn-copiar:hover {
  background: #218838;
  transform: scale(1.05);
}

.progress-envio {
  margin: 20px 0;
}

.progress-bar {
  background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
}

.lista-parlamentares-envio {
  max-height: 400px;
  overflow-y: auto;
  border: 1px solid #dee2e6;
  border-radius: 8px;
  padding: 15px;
}

.parlamentar-envio-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px;
  margin-bottom: 10px;
  background: #f8f9fa;
  border-radius: 8px;
  transition: all 0.3s;
}

.parlamentar-envio-item.enviado {
  background: #d4edda;
  opacity: 0.7;
}

.parlamentar-envio-item:hover {
  background: #e9ecef;
}

.filtros-campanha {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 20px;
}

.filtros-campanha select {
  margin-right: 10px;
  padding: 8px 12px;
  border-radius: 6px;
  border: 1px solid #ced4da;
}

/* Modal Ver Contato */
.contato-info {
  padding: 15px;
  margin-bottom: 15px;
  background: #f8f9fa;
  border-left: 4px solid #667eea;
  border-radius: 5px;
}

.contato-info-titulo {
  font-weight: bold;
  color: #667eea;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.contato-info-valor {
  margin-left: 30px;
  color: #495057;
}

.btn-acao-contato {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 20px;
  margin: 5px;
  border-radius: 25px;
  text-decoration: none;
  font-weight: 600;
  transition: all 0.3s;
}

.btn-whatsapp {
  background: #25D366;
  color: white;
}

.btn-whatsapp:hover {
  background: #128C7E;
  color: white;
  transform: scale(1.05);
}

.btn-instagram {
  background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
  color: white;
}

.btn-instagram:hover {
  transform: scale(1.05);
  color: white;
}

.assessores-lista {
  margin-top: 10px;
  padding-left: 20px;
}

.assessor-item {
  padding: 10px;
  margin-bottom: 8px;
  background: white;
  border-radius: 8px;
  border: 1px solid #e9ecef;
}

.badge-status {
  padding: 5px 12px;
  border-radius: 15px;
  font-size: 12px;
  font-weight: bold;
}

.badge-apoia { background: #28a745; color: white; }
.badge-nao-apoia { background: #dc3545; color: white; }
.badge-nao-manifestado { background: #6c757d; color: white; }

/* Tracking de Progresso */
.tracking-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: white;
  border-radius: 15px;
  padding: 20px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  z-index: 1000;
  max-width: 300px;
}

.tracking-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
  padding-bottom: 10px;
  border-bottom: 1px solid #e9ecef;
}

.tracking-item:last-child {
  border-bottom: none;
  margin-bottom: 0;
}
</style>

<div class="container">
  <h1>{{ page.title }}</h1>
  <p class="lead">{{ page.description }}</p>
  <p><strong>Casa Legislativa:</strong> {{ page.casa }}</p>
  <p><strong>Status:</strong> {{ page.status }}</p>
  
  <hr>

  <!-- SEÇÃO DE AÇÃO COLETIVA -->
  {% if page.campanha %}
  <div class="acao-coletiva">
    <h2>🎯 AÇÃO COLETIVA</h2>
    <p>Escolha como mobilizar os parlamentares desta pauta:</p>
    
    <div class="canal-grid">
      {% if page.campanha.email %}
      <div class="canal-card" onclick="abrirCampanhaEmail()">
        <div class="canal-icon">📧</div>
        <div class="canal-titulo">Email em Massa</div>
        <div class="canal-descricao">Envie para todos de uma vez</div>
        <div class="canal-contador" id="contador-emails">Carregando...</div>
      </div>
      {% endif %}
      
      {% if page.campanha.whatsapp %}
      <div class="canal-card" onclick="abrirCampanhaWhatsApp()">
        <div class="canal-icon">💬</div>
        <div class="canal-titulo">WhatsApp</div>
        <div class="canal-descricao">Envio individual (mais efetivo)</div>
        <div class="canal-contador" id="contador-whatsapp">Carregando...</div>
      </div>
      {% endif %}
      
      {% if page.campanha.instagram %}
      <div class="canal-card" onclick="abrirCampanhaInstagram()">
        <div class="canal-icon">📷</div>
        <div class="canal-titulo">Instagram</div>
        <div class="canal-descricao">Direct message individual</div>
        <div class="canal-contador" id="contador-instagram">Carregando...</div>
      </div>
      {% endif %}
    </div>
  </div>
  {% endif %}

  <!-- Resto do conteúdo da pauta continua na PARTE 2 -->
  
  <h3>Resumo da Pauta</h3>
  {{ content }}
</div>

<!-- JavaScript e Modals na PARTE 2 -->
<!-- CONTINUAÇÃO DO _layouts/pauta.html - PARTE 2 -->
<!-- Cole este conteúdo DEPOIS da PARTE 1 -->

<!-- SEÇÃO CONDICIONAL DE MEMBROS-CHAVE -->
{% if page.key_players %}
<div class="card mb-4">
  <div class="card-header">
    {% if page.is_plenary_vote %}
      <h3>Votação em Plenário</h3>
    {% else %}
      <h3>Membros-Chave nesta Pauta</h3>
    {% endif %}
  </div>
  <div class="card-body">
    {% if page.is_plenary_vote %}
      <p class="text-muted font-weight-bold">Essa pauta será julgada por todos os Deputados Federais.</p>
    {% else %}
      <p class="text-muted">Parlamentares com papéis decisivos nesta fase do projeto.</p>
    {% endif %}
    
    {% unless page.is_plenary_vote %}
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="thead-dark">
          <tr>
            <th>Nome</th>
            <th>Papel/Função</th>
            <th>Partido</th>
            <th>UF</th>
            <th>Status</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for player in page.key_players %}
            {% assign parlamentar = site.data.parlamentares_base | where: "nome", player.nome | first %}
            {% if parlamentar %}
            <tr>
              <td><strong>{{ parlamentar.nome }}</strong></td>
              <td><span class="badge badge-info">{{ player.role }}</span></td>
              <td>{{ parlamentar.partido }}</td>
              <td>{{ parlamentar.uf }}</td>
              <td>
                <span class="badge-status badge-nao-manifestado" id="status-{{ parlamentar.id }}">
                  Carregando...
                </span>
              </td>
              <td>
                <button class="btn btn-sm btn-info" onclick="verContato('{{ parlamentar.id }}', '{{ parlamentar.nome }}', '{{ parlamentar.email }}')">Ver Contato</button>
                <button class="btn btn-sm btn-warning" onclick="abrirEnviarInfo('{{ parlamentar.id }}', '{{ parlamentar.nome }}')">Enviar Info</button>
              </td>
            </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endunless %}
  </div>
</div>
{% endif %}

<!-- SEÇÃO DE TODOS OS PARLAMENTARES -->
<h2>Posicionamento de Todos os Parlamentares</h2>
<p>Use os filtros abaixo para encontrar parlamentares.</p>

<div class="form-row mb-3">
  <div class="col-md-4">
    <input type="text" id="filtro-nome" class="form-control" placeholder="Filtrar por nome...">
  </div>
  <div class="col-md-4">
    <select id="filtro-estado" class="form-control">
      <option value="">Todos os Estados</option>
    </select>
  </div>
  <div class="col-md-4">
    <select id="filtro-posicao" class="form-control">
      <option value="">Todos os Status</option>
      <option value="apoia">Apoia</option>
      <option value="nao-apoia">Não Apoia</option>
      <option value="nao-manifestado">Não se Manifestou</option>
    </select>
  </div>
</div>

<div class="table-responsive">
  <table class="table table-striped table-hover" id="tabela-parlamentares">
    <thead class="thead-dark">
      <tr>
        <th>Nome</th>
        <th>Partido</th>
        <th>UF</th>
        <th>Status</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- MODAL: VER CONTATO -->
<div class="modal fade" id="modalVerContato" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Contato: <span id="contato-nome"></span></h5>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="contato-conteudo">
          <!-- Preenchido via JavaScript -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MODAL: ENVIAR INFO -->
<div class="modal fade" id="modalEnviarInfo" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Enviar Informações: <span id="enviar-info-nome"></span></h5>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="formEnviarInfo">
          <input type="hidden" id="parlamentar-id-hidden">
          <input type="hidden" id="parlamentar-nome-hidden">
          
          <h6>📞 Dados de Contato (permanentes)</h6>
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label>WhatsApp do Deputado/Senador</label>
                <input type="text" class="form-control" id="campo-whatsapp" placeholder="11987654321">
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label>Instagram do Deputado/Senador</label>
                <input type="text" class="form-control" id="campo-instagram" placeholder="@deputadofulano">
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label>Telefone do Gabinete</label>
            <input type="text" class="form-control" id="campo-telefone" placeholder="(61) 3215-5000">
          </div>
          
          <div id="assessores-container">
            <label>Assessores</label>
            <div id="assessores-lista"></div>
            <button type="button" class="btn btn-sm btn-secondary" onclick="adicionarAssessor()">+ Adicionar Assessor</button>
          </div>
          
          <hr>
          
          <h6>📄 Evidência de Posicionamento (específica desta pauta)</h6>
          <div class="form-group">
            <label>Link/Prova</label>
            <input type="url" class="form-control" id="campo-evidencia-url" placeholder="https://...">
          </div>
          <div class="form-group">
            <label>Tipo de Evidência</label>
            <select class="form-control" id="campo-evidencia-tipo">
              <option value="noticia">Notícia</option>
              <option value="video">Vídeo</option>
              <option value="post_instagram">Post Instagram</option>
              <option value="post_twitter">Post Twitter/X</option>
              <option value="discurso">Discurso</option>
              <option value="outro">Outro</option>
            </select>
          </div>
          <div class="form-group">
            <label>Descrição</label>
            <textarea class="form-control" id="campo-evidencia-desc" rows="2" placeholder="Breve descrição da evidência..."></textarea>
          </div>
          
          <hr>
          
          <h6>👤 Seus Dados (opcional)</h6>
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label>Seu Nome</label>
                <input type="text" class="form-control" id="campo-usuario-nome" placeholder="Como deseja ser identificado">
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label>Seu Email</label>
                <input type="email" class="form-control" id="campo-usuario-email" placeholder="Para contato se necessário">
                <small class="text-muted">Não será publicado</small>
              </div>
            </div>
          </div>
          
          <div class="alert alert-info">
            ℹ️ Sua contribuição será revisada antes de ser publicada.
          </div>
          
          <button type="submit" class="btn btn-primary btn-block">📤 Enviar Contribuição</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- MODAL: CAMPANHA EMAIL -->
<div class="modal fade modal-campanha" id="modalCampanhaEmail" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">📧 Campanha por Email</h5>
        <button type="button" class="close" data-dismiss="modal" style="color: white;">&times;</button>
      </div>
      <div class="modal-body">
        <div class="filtros-campanha">
          <label><strong>Enviar para:</strong></label>
          <select id="filtro-campanha-estado" onchange="atualizarFiltrosCampanha()">
            <option value="">Todos os Estados</option>
          </select>
          <select id="filtro-campanha-posicao" onchange="atualizarFiltrosCampanha()">
            <option value="">Todos</option>
            <option value="nao-manifestado">Apenas Não Manifestados</option>
          </select>
          <div class="mt-2">
            <strong id="total-emails-campanha">0 emails selecionados</strong>
          </div>
        </div>
        
        <button class="btn btn-primary btn-lg btn-block" id="btn-abrir-email" onclick="abrirClienteEmail()">
          📧 Abrir no Meu Email
        </button>
        
        <hr>
        <p class="text-center text-muted">OU copie manualmente:</p>
        
        <div class="form-group">
          <label><strong>📧 PARA:</strong></label>
          <textarea class="form-control" id="emails-lista" rows="4" readonly></textarea>
          <button class="btn-copiar btn-block mt-2" onclick="copiarTexto('emails-lista')">📋 Copiar Emails</button>
        </div>
        
        <div class="form-group">
          <label><strong>✉️ ASSUNTO:</strong></label>
          <input type="text" class="form-control" id="email-assunto" readonly>
          <button class="btn-copiar btn-block mt-2" onclick="copiarTexto('email-assunto')">📋 Copiar Assunto</button>
        </div>
        
        <div class="form-group">
          <label><strong>📝 MENSAGEM:</strong></label>
          <textarea class="form-control" id="email-mensagem" rows="10" readonly></textarea>
          <button class="btn-copiar btn-block mt-2" onclick="copiarTexto('email-mensagem')">📋 Copiar Mensagem</button>
        </div>
        
        <div class="alert alert-warning">
          💡 <strong>Dica:</strong> Use Cco (cópia oculta) para não expor os emails dos outros!
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MODAL: CAMPANHA WHATSAPP -->
<div class="modal fade modal-campanha" id="modalCampanhaWhatsApp" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">💬 Campanha por WhatsApp</h5>
        <button type="button" class="close" data-dismiss="modal" style="color: white;">&times;</button>
      </div>
      <div class="modal-body">
        <div class="filtros-campanha">
          <label><strong>Enviar para:</strong></label>
          <select id="filtro-whatsapp-estado" onchange="atualizarListaWhatsApp()">
            <option value="">Todos os Estados</option>
          </select>
          <div class="mt-2">
            <strong id="total-whatsapp">0 WhatsApps disponíveis</strong>
          </div>
        </div>
        
        <div class="form-group">
          <label><strong>📝 Mensagem (personalize se quiser):</strong></label>
          <textarea class="form-control" id="whatsapp-mensagem" rows="6"></textarea>
        </div>
        
        <div class="progress-envio">
          <div class="progress">
            <div class="progress-bar" id="progress-whatsapp" style="width: 0%">0/0</div>
          </div>
        </div>
        
        <div class="lista-parlamentares-envio" id="lista-whatsapp"></div>
        
        <button class="btn btn-primary btn-block" id="btn-iniciar-whatsapp" onclick="iniciarEnvioWhatsApp()">
          🚀 Iniciar Envio Individual
        </button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL: CAMPANHA INSTAGRAM -->
<div class="modal fade modal-campanha" id="modalCampanhaInstagram" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">📷 Campanha por Instagram</h5>
        <button type="button" class="close" data-dismiss="modal" style="color: white;">&times;</button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning">
          ⚠️ <strong>Atenção:</strong> Instagram não permite mensagem pré-escrita. O app abrirá o Direct e você precisará colar a mensagem manualmente.
        </div>
        
        <div class="form-group">
          <label><strong>📝 Mensagem para copiar:</strong></label>
          <textarea class="form-control" id="instagram-mensagem" rows="6"></textarea>
          <button class="btn-copiar btn-block mt-2" onclick="copiarTexto('instagram-mensagem')">📋 Copiar Mensagem</button>
        </div>
        
        <div class="progress-envio">
          <div class="progress">
            <div class="progress-bar" id="progress-instagram" style="width: 0%">0/0</div>
          </div>
        </div>
        
        <div class="lista-parlamentares-envio" id="lista-instagram"></div>
        
        <button class="btn btn-primary btn-block" id="btn-iniciar-instagram" onclick="iniciarEnvioInstagram()">
          🚀 Iniciar Envio Individual
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Tracking Container (fixo no canto) -->
<div class="tracking-container" id="tracking-container" style="display: none;">
  <h6>📊 Progresso</h6>
  <div id="tracking-items"></div>
  <button class="btn btn-sm btn-secondary btn-block mt-2" onclick="fecharTracking()">Fechar</button>
</div>

<!-- JavaScript na PARTE 3 -->
<!-- CONTINUAÇÃO DO _layouts/pauta.html - PARTE 3 -->
<!-- Cole este conteúdo DEPOIS da PARTE 2 -->

<script>
// Dados globais
const pautaSlug = "{{ page.slug | default: page.title | slugify }}";
const parlamentaresBase = [{% for parl in site.data.parlamentares_base %}{"id": "{{ parl.id }}", "nome": "{{ parl.nome }}", "partido": "{{ parl.partido }}", "uf": "{{ parl.uf }}", "email": "{{ parl.email }}"},{% endfor %}];
const congressistasExtras = {{ site.data.congressistas_extras | jsonify }};
const evidenciasPautas = {{ site.data.evidencias_pautas | jsonify }};

// Campanhas (do front matter)
const campanhaEmail = {{ page.campanha.email | jsonify }};
const campanhaWhatsApp = {{ page.campanha.whatsapp | jsonify }};
const campanhaInstagram = {{ page.campanha.instagram | jsonify }};

// Tracking de envios
let trackingData = JSON.parse(localStorage.getItem('campanhas_tracking') || '{}');
if (!trackingData[pautaSlug]) {
  trackingData[pautaSlug] = { email: null, whatsapp: [], instagram: [] };
}

let assessorCount = 0;

// Inicialização
document.addEventListener('DOMContentLoaded', function() {
  carregarEstados();
  renderTabela();
  carregarContadores();
  mostrarTracking();
});

// Carregar estados no filtro
function carregarEstados() {
  const estados = [...new Set(parlamentaresBase.map(p => p.uf))].sort();
  const selects = ['filtro-estado', 'filtro-campanha-estado', 'filtro-whatsapp-estado'];
  
  selects.forEach(id => {
    const select = document.getElementById(id);
    if (select) {
      estados.forEach(uf => {
        const option = new Option(uf, uf);
        select.add(option);
      });
    }
  });
}

// Renderizar tabela de parlamentares
function renderTabela() {
  const tbody = document.querySelector('#tabela-parlamentares tbody');
  const termoNome = document.getElementById('filtro-nome').value.toLowerCase();
  const termoEstado = document.getElementById('filtro-estado').value;
  const termoPosicao = document.getElementById('filtro-posicao').value;
  
  const filtrados = parlamentaresBase.filter(p => {
    const nomeMatch = p.nome.toLowerCase().includes(termoNome);
    const estadoMatch = !termoEstado || p.uf === termoEstado;
    const posicao = obterPosicao(p.id);
    const posicaoMatch = !termoPosicao || posicao === termoPosicao;
    return nomeMatch && estadoMatch && posicaoMatch;
  });
  
  tbody.innerHTML = filtrados.map(p => {
    const posicao = obterPosicao(p.id);
    const badgeClass = posicao === 'apoia' ? 'badge-apoia' : 
                       posicao === 'nao-apoia' ? 'badge-nao-apoia' : 'badge-nao-manifestado';
    const statusTexto = posicao === 'apoia' ? 'Apoia' : 
                        posicao === 'nao-apoia' ? 'Não Apoia' : 'Não se Manifestou';
    
    return `<tr>
      <td>${p.nome}</td>
      <td>${p.partido}</td>
      <td>${p.uf}</td>
      <td><span class="badge-status ${badgeClass}">${statusTexto}</span></td>
      <td>
        <button class="btn btn-sm btn-info" onclick="verContato('${p.id}', '${p.nome}', '${p.email}')">Ver Contato</button>
        <button class="btn btn-sm btn-warning" onclick="abrirEnviarInfo('${p.id}', '${p.nome}')">Enviar Info</button>
      </td>
    </tr>`;
  }).join('');
}

// Obter posição do parlamentar
function obterPosicao(parlamentarId) {
  if (evidenciasPautas.pautas && evidenciasPautas.pautas[pautaSlug] && evidenciasPautas.pautas[pautaSlug][parlamentarId]) {
    return evidenciasPautas.pautas[pautaSlug][parlamentarId].posicao || 'nao-manifestado';
  }
  return 'nao-manifestado';
}

// Filtros
document.getElementById('filtro-nome')?.addEventListener('input', renderTabela);
document.getElementById('filtro-estado')?.addEventListener('change', renderTabela);
document.getElementById('filtro-posicao')?.addEventListener('change', renderTabela);

// VER CONTATO
function verContato(parlamentarId, nome, emailOficial) {
  const extras = congressistasExtras.congressistas?.[parlamentarId] || {};
  
  let html = `<div class="contato-info">
    <div class="contato-info-titulo">📧 Email Oficial</div>
    <div class="contato-info-valor">${emailOficial || 'Não disponível'}</div>
  </div>`;
  
  if (extras.whatsapp) {
    html += `<div class="contato-info">
      <div class="contato-info-titulo">📱 WhatsApp Pessoal</div>
      <a href="https://wa.me/55${extras.whatsapp.replace(/\D/g, '')}" target="_blank" class="btn-acao-contato btn-whatsapp">
        💬 Enviar WhatsApp
      </a>
    </div>`;
  }
  
  if (extras.telefone_gabinete) {
    html += `<div class="contato-info">
      <div class="contato-info-titulo">📞 Telefone Gabinete</div>
      <div class="contato-info-valor">${extras.telefone_gabinete}</div>
    </div>`;
  }
  
  if (extras.instagram) {
    html += `<div class="contato-info">
      <div class="contato-info-titulo">📷 Instagram</div>
      <a href="https://instagram.com/${extras.instagram.replace('@', '')}" target="_blank" class="btn-acao-contato btn-instagram">
        📷 @${extras.instagram.replace('@', '')}
      </a>
    </div>`;
  }
  
  if (extras.assessores && extras.assessores.length > 0) {
    html += `<div class="contato-info">
      <div class="contato-info-titulo">👥 Assessores</div>
      <div class="assessores-lista">`;
    
    extras.assessores.forEach(ass => {
      html += `<div class="assessor-item">
        <strong>${ass.nome}</strong> - ${ass.cargo || 'Assessor(a)'}<br>
        <a href="https://wa.me/55${ass.whatsapp.replace(/\D/g, '')}" target="_blank" class="btn-acao-contato btn-whatsapp btn-sm mt-2">
          💬 WhatsApp
        </a>
      </div>`;
    });
    
    html += `</div></div>`;
  }
  
  if (!extras.whatsapp && !extras.telefone_gabinete && !extras.instagram && (!extras.assessores || extras.assessores.length === 0)) {
    html += `<div class="alert alert-warning">
      ⚠️ Nenhuma informação adicional disponível ainda.
      <br><button class="btn btn-sm btn-primary mt-2" onclick="$('#modalVerContato').modal('hide'); abrirEnviarInfo('${parlamentarId}', '${nome}')">
        Contribuir com Informações
      </button>
    </div>`;
  }
  
  if (extras.ultima_atualizacao) {
    html += `<small class="text-muted">ℹ️ Atualizado em: ${extras.ultima_atualizacao}</small>`;
  }
  
  document.getElementById('contato-nome').textContent = nome;
  document.getElementById('contato-conteudo').innerHTML = html;
  $('#modalVerContato').modal('show');
}

// ENVIAR INFO
function abrirEnviarInfo(parlamentarId, nome) {
  document.getElementById('parlamentar-id-hidden').value = parlamentarId;
  document.getElementById('parlamentar-nome-hidden').value = nome;
  document.getElementById('enviar-info-nome').textContent = nome;
  document.getElementById('formEnviarInfo').reset();
  document.getElementById('assessores-lista').innerHTML = '';
  assessorCount = 0;
  $('#modalEnviarInfo').modal('show');
}

function adicionarAssessor() {
  assessorCount++;
  const html = `<div class="assessor-item mb-2" id="assessor-${assessorCount}">
    <div class="row">
      <div class="col-md-5">
        <input type="text" class="form-control form-control-sm" placeholder="Nome do Assessor" data-field="nome">
      </div>
      <div class="col-md-4">
        <input type="text" class="form-control form-control-sm" placeholder="WhatsApp" data-field="whatsapp">
      </div>
      <div class="col-md-3">
        <input type="text" class="form-control form-control-sm" placeholder="Cargo" data-field="cargo">
      </div>
    </div>
    <button type="button" class="btn btn-sm btn-danger mt-1" onclick="document.getElementById('assessor-${assessorCount}').remove()">Remover</button>
  </div>`;
  document.getElementById('assessores-lista').insertAdjacentHTML('beforeend', html);
}

// Submit formulário
document.getElementById('formEnviarInfo')?.addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const parlamentarId = document.getElementById('parlamentar-id-hidden').value;
  const parlamentarNome = document.getElementById('parlamentar-nome-hidden').value;
  
  // Coletar dados de contato
  const dados_contato = {};
  if (document.getElementById('campo-whatsapp').value) {
    dados_contato.whatsapp = document.getElementById('campo-whatsapp').value;
  }
  if (document.getElementById('campo-instagram').value) {
    dados_contato.instagram = document.getElementById('campo-instagram').value;
  }
  if (document.getElementById('campo-telefone').value) {
    dados_contato.telefone_gabinete = document.getElementById('campo-telefone').value;
  }
  
  // Coletar assessores
  const assessores = [];
  document.querySelectorAll('#assessores-lista .assessor-item').forEach(item => {
    const nome = item.querySelector('[data-field="nome"]').value;
    const whatsapp = item.querySelector('[data-field="whatsapp"]').value;
    const cargo = item.querySelector('[data-field="cargo"]').value;
    if (nome && whatsapp) {
      assessores.push({ nome, whatsapp, cargo: cargo || 'Assessor(a)' });
    }
  });
  if (assessores.length > 0) {
    dados_contato.assessores = assessores;
  }
  
  // Coletar evidência
  let evidencia = null;
  const evidenciaUrl = document.getElementById('campo-evidencia-url').value;
  if (evidenciaUrl) {
    evidencia = {
      tipo: document.getElementById('campo-evidencia-tipo').value,
      url: evidenciaUrl,
      descricao: document.getElementById('campo-evidencia-desc').value
    };
  }
  
  const payload = {
    parlamentar_id: parlamentarId,
    parlamentar_nome: parlamentarNome,
    pauta_slug: pautaSlug,
    dados_contato: Object.keys(dados_contato).length > 0 ? dados_contato : null,
    evidencia: evidencia,
    usuario_nome: document.getElementById('campo-usuario-nome').value,
    usuario_email: document.getElementById('campo-usuario-email').value
  };
  
  try {
    const response = await fetch('/api/contribuicoes', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    
    const data = await response.json();
    
    if (data.success) {
      alert('✅ Contribuição enviada com sucesso! Será revisada pelo administrador.');
      $('#modalEnviarInfo').modal('hide');
    } else {
      alert('❌ Erro: ' + (data.error || 'Tente novamente'));
    }
  } catch (error) {
    alert('❌ Erro ao enviar. Verifique sua conexão e tente novamente.');
  }
});

// CAMPANHAS - Contadores
function carregarContadores() {
  // Emails
  const totalEmails = parlamentaresBase.filter(p => p.email).length;
  document.getElementById('contador-emails')?.textContent = `${totalEmails} emails disponíveis`;
  
  // WhatsApp
  const totalWhatsApp = parlamentaresBase.filter(p => {
    return congressistasExtras.congressistas?.[p.id]?.whatsapp;
  }).length;
  document.getElementById('contador-whatsapp')?.textContent = `${totalWhatsApp} WhatsApps cadastrados`;
  
  // Instagram
  const totalInstagram = parlamentaresBase.filter(p => {
    return congressistasExtras.congressistas?.[p.id]?.instagram;
  }).length;
  document.getElementById('contador-instagram')?.textContent = `${totalInstagram} perfis cadastrados`;
}

// CAMPANHA EMAIL
function abrirCampanhaEmail() {
  if (!campanhaEmail) return alert('Campanha de email não configurada para esta pauta.');
  
  const emails = parlamentaresBase.filter(p => p.email).map(p => p.email);
  
  document.getElementById('emails-lista').value = emails.join('; ');
  document.getElementById('email-assunto').value = campanhaEmail.assunto || '';
  document.getElementById('email-mensagem').value = campanhaEmail.mensagem || '';
  document.getElementById('total-emails-campanha').textContent = `${emails.length} emails selecionados`;
  
  $('#modalCampanhaEmail').modal('show');
}

function abrirClienteEmail() {
  const emails = document.getElementById('emails-lista').value;
  const assunto = document.getElementById('email-assunto').value;
  const mensagem = document.getElementById('email-mensagem').value;
  
  const mailto = `mailto:?bcc=${encodeURIComponent(emails)}&subject=${encodeURIComponent(assunto)}&body=${encodeURIComponent(mensagem)}`;
  
  if (mailto.length > 2000) {
    alert('⚠️ Muitos emails! Use a opção de copiar manualmente.');
    return;
  }
  
  window.location.href = mailto;
  
  trackingData[pautaSlug].email = new Date().toISOString();
  salvarTracking();
  mostrarTracking();
}

function atualizarFiltrosCampanha() {
  // Implementar filtros
  abrirCampanhaEmail();
}

// CAMPANHA WHATSAPP
function abrirCampanhaWhatsApp() {
  if (!campanhaWhatsApp) return alert('Campanha de WhatsApp não configurada.');
  
  document.getElementById('whatsapp-mensagem').value = campanhaWhatsApp.mensagem || '';
  atualizarListaWhatsApp();
  $('#modalCampanhaWhatsApp').modal('show');
}

function atualizarListaWhatsApp() {
  const lista = document.getElementById('lista-whatsapp');
  const parlamentares = parlamentaresBase.filter(p => congressistasExtras.congressistas?.[p.id]?.whatsapp);
  
  const enviados = trackingData[pautaSlug].whatsapp || [];
  
  lista.innerHTML = parlamentares.map(p => {
    const jaEnviado = enviados.includes(p.id);
    return `<div class="parlamentar-envio-item ${jaEnviado ? 'enviado' : ''}" data-id="${p.id}">
      <div>
        <strong>${p.nome}</strong> (${p.partido}-${p.uf})
        ${jaEnviado ? '✅' : ''}
      </div>
      <button class="btn btn-sm btn-success" onclick="enviarWhatsApp('${p.id}')" ${jaEnviado ? 'disabled' : ''}>
        💬 Enviar
      </button>
    </div>`;
  }).join('');
  
  document.getElementById('total-whatsapp').textContent = `${parlamentares.length} WhatsApps disponíveis`;
  atualizarProgressoWhatsApp();
}

function enviarWhatsApp(parlamentarId) {
  const parlamentar = parlamentaresBase.find(p => p.id === parlamentarId);
  const whatsapp = congressistasExtras.congressistas[parlamentarId].whatsapp;
  const mensagem = document.getElementById('whatsapp-mensagem').value
    .replace('[NOME]', parlamentar.nome)
    .replace('[ESTADO]', parlamentar.uf)
    .replace('[PARTIDO]', parlamentar.partido);
  
  const url = `https://wa.me/55${whatsapp.replace(/\D/g, '')}?text=${encodeURIComponent(mensagem)}`;
  window.open(url, '_blank');
  
  // Marcar como enviado
  if (!trackingData[pautaSlug].whatsapp) trackingData[pautaSlug].whatsapp = [];
  if (!trackingData[pautaSlug].whatsapp.includes(parlamentarId)) {
    trackingData[pautaSlug].whatsapp.push(parlamentarId);
  }
  
  salvarTracking();
  atualizarListaWhatsApp();
  mostrarTracking();
}

function atualizarProgressoWhatsApp() {
  const total = parlamentaresBase.filter(p => congressistasExtras.congressistas?.[p.id]?.whatsapp).length;
  const enviados = (trackingData[pautaSlug].whatsapp || []).length;
  const percent = total > 0 ? (enviados / total * 100) : 0;
  
  const progressBar = document.getElementById('progress-whatsapp');
  progressBar.style.width = percent + '%';
  progressBar.textContent = `${enviados}/${total}`;
}

// CAMPANHA INSTAGRAM
function abrirCampanhaInstagram() {
  if (!campanhaInstagram) return alert('Campanha de Instagram não configurada.');
  
  document.getElementById('instagram-mensagem').value = campanhaInstagram.mensagem || '';
  atualizarListaInstagram();
  $('#modalCampanhaInstagram').modal('show');
}

function atualizarListaInstagram() {
  const lista = document.getElementById('lista-instagram');
  const parlamentares = parlamentaresBase.filter(p => congressistasExtras.congressistas?.[p.id]?.instagram);
  
  const enviados = trackingData[pautaSlug].instagram || [];
  
  lista.innerHTML = parlamentares.map(p => {
    const jaEnviado = enviados.includes(p.id);
    return `<div class="parlamentar-envio-item ${jaEnviado ? 'enviado' : ''}" data-id="${p.id}">
      <div>
        <strong>${p.nome}</strong> (${p.partido}-${p.uf})
        ${jaEnviado ? '✅' : ''}
      </div>
      <button class="btn btn-sm btn-success" onclick="enviarInstagram('${p.id}')" ${jaEnviado ? 'disabled' : ''}>
        📷 Abrir Direct
      </button>
    </div>`;
  }).join('');
  
  atualizarProgressoInstagram();
}

function enviarInstagram(parlamentarId) {
  const instagram = congressistasExtras.congressistas[parlamentarId].instagram.replace('@', '');
  const url = `https://ig.me/m/${instagram}`;
  window.open(url, '_blank');
  
  // Marcar como enviado
  if (!trackingData[pautaSlug].instagram) trackingData[pautaSlug].instagram = [];
  if (!trackingData[pautaSlug].instagram.includes(parlamentarId)) {
    trackingData[pautaSlug].instagram.push(parlamentarId);
  }
  
  salvarTracking();
  atualizarListaInstagram();
  mostrarTracking();
}

function atualizarProgressoInstagram() {
  const total = parlamentaresBase.filter(p => congressistasExtras.congressistas?.[p.id]?.instagram).length;
  const enviados = (trackingData[pautaSlug].instagram || []).length;
  const percent = total > 0 ? (enviados / total * 100) : 0;
  
  const progressBar = document.getElementById('progress-instagram');
  progressBar.style.width = percent + '%';
  progressBar.textContent = `${enviados}/${total}`;
}

// TRACKING
function salvarTracking() {
  localStorage.setItem('campanhas_tracking', JSON.stringify(trackingData));
}

function mostrarTracking() {
  const dados = trackingData[pautaSlug];
  if (!dados) return;
  
  let temProgresso = false;
  let html = '';
  
  if (dados.email) {
    temProgresso = true;
    html += `<div class="tracking-item">
      <span>📧 Email</span>
      <span>✅ Enviado</span>
    </div>`;
  }
  
  if (dados.whatsapp && dados.whatsapp.length > 0) {
    temProgresso = true;
    const total = parlamentaresBase.filter(p => congressistasExtras.congressistas?.[p.id]?.whatsapp).length;
    html += `<div class="tracking-item">
      <span>💬 WhatsApp</span>
      <span>${dados.whatsapp.length}/${total}</span>
    </div>`;
  }
  
  if (dados.instagram && dados.instagram.length > 0) {
    temProgresso = true;
    const total = parlamentaresBase.filter(p => congressistasExtras.congressistas?.[p.id]?.instagram).length;
    html += `<div class="tracking-item">
      <span>📷 Instagram</span>
      <span>${dados.instagram.length}/${total}</span>
    </div>`;
  }
  
  if (temProgresso) {
    document.getElementById('tracking-items').innerHTML = html;
    document.getElementById('tracking-container').style.display = 'block';
  }
}

function fecharTracking() {
  document.getElementById('tracking-container').style.display = 'none';
}

// Utilitários
function copiarTexto(elementId) {
  const element = document.getElementById(elementId);
  element.select();
  document.execCommand('copy');
  alert('✅ Copiado para área de transferência!');
}
</script>

</body>
</html>
